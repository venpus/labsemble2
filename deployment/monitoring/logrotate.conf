# LABSEMBLE Log Rotation Configuration for AWS Lightsail
# File: /etc/logrotate.d/labsemble

# Application logs
/var/log/labsemble/*.log {
    daily
    missingok
    rotate 52
    compress
    delaycompress
    notifempty
    create 664 labsemble www-data
    postrotate
        if command -v pm2 &> /dev/null; then
            pm2 reloadLogs
        fi
    endscript
}

# Nginx logs
/var/log/nginx/*.log {
    daily
    missingok
    rotate 52
    compress
    delaycompress
    notifempty
    create 644 www-data adm
    postrotate
        if [ -f /var/run/nginx.pid ]; then
            kill -USR1 $(cat /var/run/nginx.pid)
        fi
    endscript
}

# MongoDB logs
/var/log/mongodb/*.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 644 mongodb mongodb
    postrotate
        if systemctl is-active --quiet mongod; then
            systemctl reload mongod
        fi
    endscript
}

# PM2 logs
/home/labsemble/.pm2/logs/*.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 664 labsemble www-data
    postrotate
        if command -v pm2 &> /dev/null; then
            pm2 reloadLogs
        fi
    endscript
}

# SSL renewal logs
/var/log/ssl-renewal.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 644 root root
}

# MongoDB backup logs
/var/log/mongodb-backup.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 644 root root
}

# MongoDB monitoring logs
/var/log/mongodb-monitor.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 644 root root
}

# Lightsail specific logs
/var/log/lightsail-monitor.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 644 root root
}

/var/log/lightsail-backup.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 644 root root
} 